import type { Meta, ComponentStory, StoryFn, StoryObj,  } from '@storybook/react';
import type { FC } from 'react';
import React, { useRef } from 'react';

import { Editor } from '@/components/Editor';
import type { ContentItem } from '@/lib/Types';
// import { editorSaveHandler, imageUploadHandler, imagePreviewHandler } from './editor.mock';
import { MDXProvider } from '@mdx-js/react';
import { ArrowRightSharp, LocalAtmRounded } from '@mui/icons-material';
import dynamic from 'next/dynamic'
import { Suspense } from 'react'
import {
  type MDXEditorMethods,
} from '@mdxeditor/editor'
// import DummyMDX from './DummyMDX.txt';

// // import mdxContent from './_DummyMDX.mdx';
// const editorSaveHandlerMock = editorSaveHandler.mockReturnValue(Promise.resolve('successfully saved file'));
// const imageUploadHandlerMock = imageUploadHandler.mockReturnValue(Promise.resolve('https://picsum.photos/200/300?grayscale'));
// const imagePreviewHandlerMock = imagePreviewHandler.mockReturnValue(Promise.resolve('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAYCAYAAABurXSEAAAAAXNSR0IArs4c6QAAAGJlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAABJKGAAcAAAASAAAAUKABAAMAAAABAAEAAKACAAQAAAABAAAALaADAAQAAAABAAAAGAAAAABBU0NJSQAAAFNjcmVlbnNob3QGyMkKAAAB1GlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj4yNDwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj40NTwvZXhpZjpQaXhlbFhEaW1lbnNpb24+CiAgICAgICAgIDxleGlmOlVzZXJDb21tZW50PlNjcmVlbnNob3Q8L2V4aWY6VXNlckNvbW1lbnQ+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgq7qfQQAAADGUlEQVRYCWP8DwQMQwwwDTH3gp076mh6xdpoSA+7kH795g3DspWrGV68eAn229Vr18H8P3/+kO5XUJGHDeQWlfxX0zHAJvX/y5cv/wUlZP5390/EKo9N8PSZs2A9Bw4eAktPnDINzP/27Rs25XjFcKbpf3//Mnz/8QNrKABNBIv/+/cPqzytBXE6mtYWU2I+1Rz9+fMXhsbWdgZTa3sGOVVNBmDyYrhz9y5Jbtuzbz9DXFIqg5CkLIOtsxtDc3snw/fv3zHMoIqj/wKTUnpOHgMwnTLYWFkyJCfEMezavZchIDSS4e27dxiWYhM4dOQoQ1h0HMNtoEfLiwsZtDU1GfonTWFIz85jAJmPDFiQOehsYIYDWhyBLszw+/dvFLEdu/cw7Ni1m2HGlIkMYcFBYLmQwABwaM1dsIihrKgART02TnF5FYOCvBzDzs0bGfj4eMFKdLS1GOqaWhgOHDrM4OzoANdGMKQ5ODgY0DEnJyfcABDj/IWLYL6CnBzDhUuXwfg3tCg7ceoUilpsHFDg3L13jyEqIhzuYJC62OhIsPJLl6+gaMMb0jw8PAwrFi9A0QDigCwBpVsYOHfhApjp4RcIE4LTV69eh7NxMe49eACWUpSXR1HCz8fHAHLDrdt3UMTxOhpFJR6OproGw4GDhxluX73IwMSEGnnofGzGyEhLg4WfPX+OIg3KhKAAAiUbZIBqA7IMCWx9PR2w6mvXbzAICgjA8aHDRxjOnD1H0CQhQUEGKUlJhg2btwDzC6KG3L5zN1ivjo42ihlUcbSHqyuDupoqQ3RCMsO0mbMZtmzfwZBTUMSQmJbJ8ODhIxQLcXGqykvBeSMxLZ1h3YZNDBMmT2VIycxmMDTQZ3Cyt0PRhjN5MKJFM7IuRkZGMBdGg3L7qqWLGEoraxhqGprAcqC02FBTxZAUH4uslYEBTS/MjKjwUIavX78yzJo7H+xYkCYvDzeGvs4OBvSMzwiq5FFNpYz3C1gcfvzwkUFYWAgjfRNr8vsPHxh4gZ5mYcEeplR3NLEOo0QdVdI0JQ4gR++oo8kJNXL0AADsUIxP1kwKcwAAAABJRU5ErkJggg=='));
  // const imagePreviewHandler = useCallback(
  //   async (imageSource: string, context: ContentItem) => {
  //     if (imageSource.startsWith('http') && context) return imageSource;
  //     return Promise.resolve('data:image/png;base64,iVBORw0KGgoAAAANSUhEU==');
  //   },
  //   [],
  // );

  // // ,
  // const imageUploadHandler = useCallback(async () => {
  //   return Promise.resolve('https://picsum.photos/200/300?grayscale');
  // }, []);
  // const EditorComp = dynamic(() => import('./Editor'), { ssr: false })

  const dummyContext: ContentItem = {
    source: 'github',
    repo: 'airwalk_patterns',
    owner: 'airwalk-digital',
    branch: 'main',
    path: 'providers',
    reference: 'provider',
    collections: ['services'],
  };

const meta = {
  title: 'Content/Editor',
  component: Editor,
  // render: (args, { loaded: { mdx } }) => (
    
  //   <Suspense fallback={null}>
  //   <Editor {...args} markdown={mdx} />
  // </Suspense>),
  args: {
    // imagePreviewHandler: imagePreviewHandlerMock,
    // imageUploadHandler: imageUploadHandlerMock,
    // editorSaveHandler: editorSaveHandlerMock,
    // editorSaveHandler: editorSaveHandler.mockReturnValue(Promise.resolve('successfully saved file')),
    markdown: '',
    top: 0,
    context: dummyContext,
  }
  // async beforeEach() {
  //   // ðŸ‘‡ Set the return values
  //   editorSaveHandler.mockReturnValue(Promise.resolve('successfully saved file'));
  //   imageUploadHandler.mockReturnValue(Promise.resolve('https://picsum.photos/200/300?grayscale'));
  //   imagePreviewHandler.mockReturnValue(Promise.resolve('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAYCAYAAABurXSEAAAAAXNSR0IArs4c6QAAAGJlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAABJKGAAcAAAASAAAAUKABAAMAAAABAAEAAKACAAQAAAABAAAALaADAAQAAAABAAAAGAAAAABBU0NJSQAAAFNjcmVlbnNob3QGyMkKAAAB1GlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj4yNDwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj40NTwvZXhpZjpQaXhlbFhEaW1lbnNpb24+CiAgICAgICAgIDxleGlmOlVzZXJDb21tZW50PlNjcmVlbnNob3Q8L2V4aWY6VXNlckNvbW1lbnQ+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgq7qfQQAAADGUlEQVRYCWP8DwQMQwwwDTH3gp076mh6xdpoSA+7kH795g3DspWrGV68eAn229Vr18H8P3/+kO5XUJGHDeQWlfxX0zHAJvX/y5cv/wUlZP5390/EKo9N8PSZs2A9Bw4eAktPnDINzP/27Rs25XjFcKbpf3//Mnz/8QNrKABNBIv/+/cPqzytBXE6mtYWU2I+1Rz9+fMXhsbWdgZTa3sGOVVNBmDyYrhz9y5Jbtuzbz9DXFIqg5CkLIOtsxtDc3snw/fv3zHMoIqj/wKTUnpOHgMwnTLYWFkyJCfEMezavZchIDSS4e27dxiWYhM4dOQoQ1h0HMNtoEfLiwsZtDU1GfonTWFIz85jAJmPDFiQOehsYIYDWhyBLszw+/dvFLEdu/cw7Ni1m2HGlIkMYcFBYLmQwABwaM1dsIihrKgART02TnF5FYOCvBzDzs0bGfj4eMFKdLS1GOqaWhgOHDrM4OzoANdGMKQ5ODgY0DEnJyfcABDj/IWLYL6CnBzDhUuXwfg3tCg7ceoUilpsHFDg3L13jyEqIhzuYJC62OhIsPJLl6+gaMMb0jw8PAwrFi9A0QDigCwBpVsYOHfhApjp4RcIE4LTV69eh7NxMe49eACWUpSXR1HCz8fHAHLDrdt3UMTxOhpFJR6OproGw4GDhxluX73IwMSEGnnofGzGyEhLg4WfPX+OIg3KhKAAAiUbZIBqA7IMCWx9PR2w6mvXbzAICgjA8aHDRxjOnD1H0CQhQUEGKUlJhg2btwDzC6KG3L5zN1ivjo42ihlUcbSHqyuDupoqQ3RCMsO0mbMZtmzfwZBTUMSQmJbJ8ODhIxQLcXGqykvBeSMxLZ1h3YZNDBMmT2VIycxmMDTQZ3Cyt0PRhjN5MKJFM7IuRkZGMBdGg3L7qqWLGEoraxhqGprAcqC02FBTxZAUH4uslYEBTS/MjKjwUIavX78yzJo7H+xYkCYvDzeGvs4OBvSMzwiq5FFNpYz3C1gcfvzwkUFYWAgjfRNr8vsPHxh4gZ5mYcEeplR3NLEOo0QdVdI0JQ4gR++oo8kJNXL0AADsUIxP1kwKcwAAAABJRU5ErkJggg=='));
  // },
} satisfies Meta<typeof Editor>

export default meta;



// interface Args {
//   result: string;
//   loaded: {
//     mdxContent: string;
//   };
// }

// const Template: FC<Args> = ({ result, loaded: { mdxContent } }) => {
//   // const [mdxContent, setMdxContent] = useState('');

//   const imagePreviewHandler = useCallback(
//     async (imageSource: string, context: ContentItem) => {
//       if (imageSource.startsWith('http') && context) return imageSource;
//       return Promise.resolve('data:image/png;base64,iVBORw0KGgoAAAANSUhEU==');
//     },
//     [],
//   );

//   // ,
//   const imageUploadHandler = useCallback(async () => {
//     return Promise.resolve('https://picsum.photos/200/300?grayscale');
//   }, []);

//   // eslint-disable-next-line no-promise-executor-return
//   const delay = (ms: number) =>
//     new Promise<void>((resolve) => setTimeout(() => resolve(), ms));

//   const dummyFunction = useCallback(async () => {
//     await delay(2000);
//     switch (result) {
//       case 'success':
//         return 'Successfully saved file';
//       case 'error':
//         throw new Error('An error occurred');
//       default:
//         throw new Error('An error occurred');
//     }
//   }, [result]);

//   // useEffect(() => {
//   //   const styleLink = document.createElement('link');
//   //   styleLink.rel = 'stylesheet';
//   //   styleLink.href =
//   //     'https://unpkg.com/@mdxeditor/editor@1.14.3/dist/style.css';
//   //   document.head.appendChild(styleLink);
//   //   setMdxContent(mdxDemo.toString());
//   //   // fetch(args.file)
//   //   //   .then((response) => response.text())
//   //   //   .then((text) => setMdxContent(text));
//   // }, []);

//   return (
//     <Editor
//       top={0}
//       markdown={mdxContent}
//       context={dummyContext}
//       callbackSave={dummyFunction}
//       imageUploadHandler={imageUploadHandler}
//       imagePreviewHandler={imagePreviewHandler}
//     />
//   );
// };

// type Story = StoryObj<typeof meta>;

const Template: StoryFn<typeof Editor> = (args) => {
  const editorRef = useRef(null);
  return <Editor {...args} editorRef={editorRef} />;
};


export const Default: StoryFn = Template.bind({});
Default.loaders = [
    async () => ({
      markdown: await (await fetch('/test/full-mdx.mdx')).text(),
    }),
  ]
Default.args = {
    editorSaveHandler: async (content: string) => {
      console.log('Save handler called with content:', content);
      return 'Save successful';
    },
    imageUploadHandler: async (image: File) => {
      console.log('Image upload handler called with image:', image);
      return 'https://example.com/uploaded_image.jpg';
    },
    imagePreviewHandler: async (imageSource: string) => {
      console.log('Image preview handler called with source:', imageSource);
      return imageSource;
    },
    enabled: true,
    top: 0
  }

export const MinimalMDX: Story = Template.bind({});
MinimalMDX.loaders = [
  async () => ({
    mdx: await (await fetch('/test/short-mdx.mdx')).text(),
  }),
]

MinimalMDX.args = {
    // editorSaveHandler: editorSaveHandler.mockReturnValue(Promise.resolve('successfully saved file')),
    enabled: true,
    top: 0
  
};

// let Default = Template.bind({});
// Default = {
//   file: '/test/full-mdx.mdx',
//   context: dummyContext,
//   enabled: true,
//   top: 0,
//   result: 'success',
// };

// export const APIError = Template.bind({});
// APIError.args = {
//   file: '/test/full-mdx.mdx',
//   context: dummyContext,
//   enabled: true,
//   top: 0,
//   result: 'error',
// };



// let Default = Template.bind({});
// Default = {
//   file: '/test/full-mdx.mdx',
//   context: dummyContext,
//   enabled: true,
//   top: 0,
//   result: 'success',
// };

// export const APIError = Template.bind({});
// APIError.args = {
//   file: '/test/full-mdx.mdx',
//   context: dummyContext,
//   enabled: true,
//   top: 0,
//   result: 'error',
// };


// // components/Editor.stories.tsx
// import React, { useRef } from 'react';
// import { StoryFn, Meta } from '@storybook/react';
// import { Editor } from './Editor';
// import { ContentItem } from '@/lib/Types';

// export default {
//   title: 'Components/Editor',
//   component: Editor,
// } as Meta<typeof Editor>;

// const Template: StoryFn<typeof Editor> = (args) => {
//   const editorRef = useRef(null);
//   return <Editor {...args} editorRef={editorRef} />;
// };

// export const Default = Template.bind({});
// Default.args = {
//   markdown: '# Hello World',
//   context: { path: 'example' } as ContentItem,
//   editorSaveHandler: async (content: string) => {
//     console.log('Save handler called with content:', content);
//     return 'Save successful';
//   },
//   imageUploadHandler: async (image: File) => {
//     console.log('Image upload handler called with image:', image);
//     return 'https://example.com/uploaded_image.jpg';
//   },
//   imagePreviewHandler: async (imageSource: string) => {
//     console.log('Image preview handler called with source:', imageSource);
//     return imageSource;
//   },
//   enabled: true,
//   top: 100,
// };
